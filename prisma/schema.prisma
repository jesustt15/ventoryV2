generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// --- DATOS MAESTROS DE EQUIPOS ---
model Marca {
  id     String   @id @default(uuid())
  nombre String   @unique // Nombre de la marca, ej: Dell, HP, Apple
  modelos ModeloDispositivo[] // Una marca puede tener muchos modelos
}

model ModeloDispositivo {
  id            String    @id @default(uuid())
  nombre        String    // Nombre del modelo, ej: Latitude 5400, iPhone 13, ThinkPad T480
  marcaId       String
  marca         Marca     @relation(fields: [marcaId], references: [id])
  tipo          String    // Ej: "Laptop", "Desktop", "Monitor", "Teléfono IP", "Impresora", "Switch"
  // Puedes añadir más campos específicos del modelo aquí si es necesario,
  // como especificaciones base, año de lanzamiento, etc.

  computadores  Computador[]
  dispositivos  Dispositivo[] // Renombrado de Equipos a Dispositivo
}

// --- ESTRUCTURAS EXISTENTES MODIFICADAS ---
model Gerencia {
  id            String         @id @default(uuid())
  nombre        String
  sociedad      String
  departamentos Departamento[]
}

model Departamento {
  id           String       @id @default(uuid())
  nombre       String
  gerenciaId   String
  ceco         String
  gerencia     Gerencia     @relation(fields: [gerenciaId], references: [id])
  usuarios     Usuario[]
  computadores Computador[]
  dispositivos Dispositivo[] // Renombrado de Equipos a Dispositivo
}

model Usuario {
  id             String       @id @default(uuid())
  nombre         String
  apellido       String
  cargo          String
  legajo         Int
  ced            String
  departamentoId String
  departamento   Departamento @relation(fields: [departamentoId], references: [id])
  computadores   Computador[]
  dispositivos   Dispositivo[] // Renombrado de Equipos a Dispositivo
}

model Computador {
  id             String          @id @default(uuid())
  serial         String          @unique // El serial es único para esta instancia
  estado         String          // Ej: Activo, En Reparación, De Baja, Almacenado
  modeloId       String          // Relación al modelo específico
  modelo         ModeloDispositivo @relation(fields: [modeloId], references: [id])
  usuarioId      String?
  usuario        Usuario?        @relation(fields: [usuarioId], references: [id])
  departamentoId String?
  departamento   Departamento?   @relation(fields: [departamentoId], references: [id])
  img            String?         // URL o ruta de la imagen
  // 'tipo' aquí podría ser redundante si 'ModeloDispositivo.tipo' es suficiente,
  // o podría usarse para un estado más específico del computador (ej: "Portátil de Gerencia")
  // Por ahora lo comento para simplificar, asumiendo que el tipo viene del ModeloDispositivo.
  // tipo           String
  // 'marca' y 'modelo' como strings se eliminan, ahora vienen de la relación con ModeloDispositivo
}

// Renombrado de Equipos a Dispositivo para mayor claridad y evitar colisión de nombres
model Dispositivo {
  id             String          @id @default(uuid())
  serial         String          @unique // El serial es único para esta instancia
  estado         String          // Ej: Activo, En Reparación, De Baja, Almacenado
  modeloId       String          // Relación al modelo específico
  modelo         ModeloDispositivo @relation(fields: [modeloId], references: [id])
  usuarioId      String?
  usuario        Usuario?        @relation(fields: [usuarioId], references: [id])
  departamentoId String?
  departamento   Departamento?   @relation(fields: [departamentoId], references: [id])
  img            String?         // URL o ruta de la imagen
  // 'tipo' aquí podría ser redundante si 'ModeloDispositivo.tipo' es suficiente.
  // tipo           String
  // 'marca' y 'modelo' como strings se eliminan
  lineas         LineaTelefonica[]
}

model LineaTelefonica {
  id           String      @id @default(uuid())
  numero       String
  proveedor    String
  dispositivoId String      // Cambiado de equiposId a dispositivoId
  dispositivo  Dispositivo @relation(fields: [dispositivoId], references: [id]) // Cambiado de Equipos a Dispositivo
}

model User { // Para autenticación de la app
  id       String @id @default(uuid())
  username String @unique
  password String
}

model Asignaciones {
  id           Int      @id @default(autoincrement())
  date         DateTime @default(now())
  equipoId     String   // Este ID ahora podría referenciar a Computador.id o Dispositivo.id
  equipoType   String   // "Computador" o "Dispositivo" para saber a qué tabla apunta equipoId
  usuarioId    String
  type         String   // "Assignment" o "Return"
  notes        String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

}